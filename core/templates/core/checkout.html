{% extends 'main.html' %}
{% block content %}

<div class="checkout-container">
    <h1 class="checkout-title">Checkout</h1>
    <div class="checkout-breakdown">
        <h3 class="checkout-breakdown-title">Price Breakdown</h3>
        <table class="checkout-breakdown-table">
            <tr>
                <td>Items Total:</td>
                <td>₹{{ items_total }}</td>
            </tr>
            <tr>
                <td>Delivery Fee:</td>
                <td>₹200</td>
            </tr>
            <tr>
                <td>Total Payable:</td>
                <td>₹{{ items_total|add:"200" }}</td>
            </tr>
        </table>
    </div>
    <div class="checkout-address-section">
        <form method="post" class="checkout-form">
            {% csrf_token %}
            <div class="checkout-address-header">
              <h3 class="checkout-address-title">Select Delivery Address</h3>
              <button type="button" class="checkout-add-address-btn" data-toggle="add-address-form">Add New Address</button>
            </div>
            {% if addresses %}
              <div class="list-picker" data-field="address_id">
                <button type="button" class="picker-header">
                  <span class="picker-title">Address</span>
                  <span class="picker-selected" data-placeholder="Select Address">Select Address</span>
                  <span class="picker-caret">▾</span>
                </button>
                <div class="picker-panel">
                  <div class="component-grid">
                    {% for address in addresses %}
                      <div class="component-card">
                        <div class="card-desc">{{ address.line1 }}, {{ address.line2 }}, {{ address.city }}, {{ address.state }}, {{ address.postal_code }}, {{ address.country }}</div>
                        <button type="button" class="card-pick list-pick" data-id="{{ address.id }}">Select</button>
                      </div>
                    {% endfor %}
                  </div>
                </div>
                <input type="hidden" name="address_id" value="{% if addresses %}{{ addresses.0.id }}{% endif %}">
              </div>
            {% else %}
              <p class="checkout-no-address">No saved addresses. Please add one below.</p>
            {% endif %}
            <div id="add-address-form" class="checkout-add-address-form">
                {% for field in address_form %}
                    {{ field }}
                {% endfor %}
                <button type="submit" name="add_address" class="checkout-save-address-btn">Save Address</button>
            </div>
            <hr class="checkout-divider">
            <h3 class="checkout-payment-title">Payment Method</h3>
            <div class="list-picker" data-field="payment_method">
              <button type="button" class="picker-header">
                <span class="picker-title">Payment</span>
                <span class="picker-selected" data-placeholder="Select Payment Method">Select Payment Method</span>
                <span class="picker-caret">▾</span>
              </button>
              <div class="picker-panel">
                <div class="component-grid">
                  <div class="component-card"><div class="card-title">Cash on Delivery</div><button type="button" class="card-pick list-pick" data-id="cod">Select</button></div>
                  <div class="component-card"><div class="card-title">UPI</div><button type="button" class="card-pick list-pick" data-id="upi">Select</button></div>
                  <div class="component-card"><div class="card-title">Card</div><button type="button" class="card-pick list-pick" data-id="card">Select</button></div>
                </div>
              </div>
              <input type="hidden" name="payment_method" value="cod">
            </div>
            <button type="submit" name="place_order" class="checkout-place-order-btn">Place Order</button>
        </form>
    </div>
</div>

{% endblock content %}